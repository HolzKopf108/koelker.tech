<!-- src/app/pages/admin.page.html -->
<section class="admin-panel animate-in space-y-8">
  <header class="flex flex-wrap items-center justify-between gap-4">
    <div>
      <div class="flex items-center gap-2">
        <p class="text-xs font-semibold text-emerald-300">Admin</p>
        <span class="pill text-[10px] px-2 py-0.5">v{{ version }}</span>
      </div>
      <h1 class="mt-2 text-3xl font-semibold text-zinc-50">Dashboard</h1>
      <p class="mt-2 text-sm text-zinc-400">
        Analytics · Zeitzone {{ timezone() }} · Stichprobe: {{ sampleLabel() }}
      </p>
    </div>

    <div class="flex flex-wrap items-center gap-3 w-full sm:w-auto">
      <div class="flex flex-wrap items-center gap-2 w-full sm:w-auto">
        <label class="text-xs uppercase tracking-wide text-zinc-400">Zeitraum</label>
        <div class="select-wrap w-full sm:w-auto">
          <select
            class="select lift press w-full sm:w-auto"
            [disabled]="loading()"
            (change)="onDaysChange(($any($event.target).value))"
          >
          @for (option of daysOptions; track option) {
            <option [value]="option" [selected]="option === selectedDays()">
              {{ option }} Tage
            </option>
          }
          </select>
        </div>
      </div>

      <button class="btn-ghost lift press" type="button" [disabled]="loading()" (click)="logout()">
        Logout
      </button>
    </div>
  </header>

  @if (loading()) {
    <div class="text-sm text-zinc-400">Lade Daten…</div>
  }

  @if (error()) {
    <div class="rounded-xl border border-rose-500/30 bg-rose-500/10 px-4 py-3 text-sm text-rose-200">
      {{ error() }}
    </div>
  }

  <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
    <div class="card">
      <p class="text-xs font-semibold text-emerald-300">Pageviews gesamt</p>
      <p class="mt-3 text-2xl font-semibold text-zinc-50">
        {{ summary() ? formatNumber(summary()?.totalPageviews) : '-' }}
      </p>
      <p class="mt-1 text-xs text-zinc-500">
        Ø {{ summary() ? formatAverage(summary()?.averagePageviews) : '-' }} / Tag
      </p>
    </div>

    <div class="card">
      <p class="text-xs font-semibold text-emerald-300">Uniques (Schätzung)</p>
      <p class="mt-3 text-2xl font-semibold text-zinc-50">
        {{ summary() ? formatNumber(summary()?.totalUniques) : '-' }}
      </p>
      <p class="mt-1 text-xs text-zinc-500">
        Ø {{ summary() ? formatAverage(summary()?.averageUniques) : '-' }} / Tag
      </p>
    </div>

    <div class="card">
      <p class="text-xs font-semibold text-emerald-300">Pageviews (Ø/Tag)</p>
      <p class="mt-3 text-2xl font-semibold text-zinc-50">
        {{ summary() ? formatAverage(summary()?.averagePageviews) : '-' }}
      </p>
      <p class="mt-1 text-xs text-zinc-500">Zeitraum {{ selectedDays() }} Tage</p>
    </div>

    <div class="card">
      <p class="text-xs font-semibold text-emerald-300">Uniques (Schätzung/Tag)</p>
      <p class="mt-3 text-2xl font-semibold text-zinc-50">
        {{ summary() ? formatAverage(summary()?.averageUniques) : '-' }}
      </p>
      <p class="mt-1 text-xs text-zinc-500">Zeitraum {{ selectedDays() }} Tage</p>
    </div>
  </div>

  <div class="grid gap-4 lg:grid-cols-2">
    <div class="card space-y-4 min-w-0">
      <div class="flex items-center justify-between gap-3">
        <div>
          <p class="text-xs font-semibold text-emerald-300">Pageviews pro Tag</p>
          <p class="mt-1 text-xs text-zinc-500">Punkte: {{ chartSeries().length }}</p>
        </div>
        @if (selectedPageviews()) {
          <div class="text-right text-xs text-zinc-400">
            <p>Auswahl</p>
            <p class="text-zinc-200">
              {{ formatDateLabel(selectedPageviews()?.date || '') }} ·
              {{ formatNumber(selectedPageviews()?.pageviews) }}
            </p>
          </div>
        }
      </div>

      <div class="chart-frame">
        <canvas #pageviewsCanvas></canvas>
      </div>
    </div>

    <div class="card space-y-4 min-w-0">
      <div class="flex items-center justify-between gap-3">
        <div>
          <p class="text-xs font-semibold text-emerald-300">Uniques pro Tag (Schätzung)</p>
          <p class="mt-1 text-xs text-zinc-500">Punkte: {{ chartSeries().length }}</p>
        </div>
        @if (selectedUniques()) {
          <div class="text-right text-xs text-zinc-400">
            <p>Auswahl</p>
            <p class="text-zinc-200">
              {{ formatDateLabel(selectedUniques()?.date || '') }} ·
              {{ formatNumber(selectedUniques()?.uniques) }}
            </p>
          </div>
        }
      </div>

      <div class="chart-frame">
        <canvas #uniquesCanvas></canvas>
      </div>
    </div>
  </div>
</section>
